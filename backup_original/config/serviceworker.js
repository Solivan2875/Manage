function reportError(e){self.Sentry?self.Sentry.captureException(e):console.error(e)}var NOTE_EDITOR_APP_VERSION="4559023",ASSET_CACHE_NAME=NOTE_EDITOR_APP_VERSION+"-notes-app",VENDOR_CACHE_VERSION="v4",VENDOR_CACHE_NAME=VENDOR_CACHE_VERSION+"-vendor",NOTE_CACHE_VERSION="v3",NOTE_CACHE_NAME=NOTE_CACHE_VERSION+"-notes",CACHEABLE_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"],VENDOR_ASSETS=["../assets/fonts/materialicons-latin-400normal-dafdbac44033fa5944dd6dfc4faf59c0fdee74e776d27b840c9738846933d976.woff2","../assets/fonts/roboto-v20-latin-regular-226f9e8b0157036149b2807307f7a1db204e52f66b7c0c64c9c8cb3913ec953b.woff2","../assets/fonts/roboto-v20-latin-italic-88ae4e700940da34eb8a91e43c50095d02ac21c3c38dad5e994d1005e0992e2f.woff2","../assets/fonts/roboto-v20-latin-700-ca0f03b94bf1251df280675a5d04500471c558454ef7176c21ac229603bcb069.woff2","../vendor/react.production.min.js","../vendor/react-dom.production.min.js"];try{self.importScripts("https://browser.sentry-cdn.com/6.19.7/bundle.min.js")}catch(_error){self.Sentry=null}self.Sentry&&self.Sentry.init({dsn:"https://cb0a33c5db9a4b09a607b17374f46cd8@sentry.io/217203",fetchParameters:{credentials:"omit"},release:"7d890fd6675aba473cb107856df51f2d8e574842",tunnel:"/error-reporting/"});try{function etagValueFromResponse(e){const t=e.headers.get("ETag");return t?t.replace(/^(?:W\/)?"?(.+?)"?$/,"$1"):t}function versionFromResponse(e){return etagValueFromResponse(e)||e.headers.get("X-Version")}function messageClients(e){return self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e)})})}function onInstall(e){var t=Promise.all([caches.open(ASSET_CACHE_NAME).then(function(e){return e.addAll(["../assets/js/application.js","../assets/css/application.css","../assets/css/notes.css","../assets/js/runtime.js","../assets/js/note_editor_app.js","../assets/css/note_editor_app.css","../pages/notes.html"]),e.add(new Request("/pages/notes.html",{credentials:"same-origin",redirect:"manual"}))}),caches.open(VENDOR_CACHE_NAME).then(function(e){var t=VENDOR_ASSETS.map(function(t){return e.match(t).then(function(s){return s?Promise.resolve():e.add(t)})});return t.push(e.keys().then(function(t){return Promise.all(t.filter(function(e){return!VENDOR_ASSETS.includes(e.url)}).map(function(t){return e["delete"](t)}))})),Promise.all(t)})]);e.waitUntil(t.then(function(){return self.skipWaiting()})["catch"](reportError))}function onActivate(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(function(e){return e!==ASSET_CACHE_NAME&&e!==NOTE_CACHE_NAME&&e!==VENDOR_CACHE_NAME}).map(function(e){return caches["delete"](e)}))}).then(function(){return self.clients.claim()})["catch"](reportError))}function onMessage(e){var t=null,s=e.data;switch(s.type){case"CLEAR_CACHES":t=caches.keys().then(function(e){return Promise.all(e.map(function(e){return caches["delete"](e)})).then(function(){return messageClients({type:"CACHES_CLEARED"})})});break;case"FETCH_CACHED_NOTE":t=caches.open(NOTE_CACHE_NAME).then(function(e){e.match(s.uuid).then(function(e){if(e){var t=versionFromResponse(e),n=e.headers.get("Encryption-Key");return e.text().then(function(e){return messageClients({type:"CACHED_NOTE",uuid:s.uuid,content:e,digest:t,key:n})})}return messageClients({type:"CACHED_NOTE",uuid:s.uuid})})});break;case"LIST_CACHED_NOTES":t=caches.open(NOTE_CACHE_NAME).then(function(e){return e.keys().then(function(t){return Promise.all(t.map(function(t){return e.match(t)})).then(function(e){return{requests:t,responses:e}})}).then(function(e){for(var t=e.requests,s=e.responses,n={},a=0;a<t.length;a++){var c=t[a],o=s[a];if(!o)continue;const e=c.url.match(/\/([A-F\d-]+)$/i);if(e)n[e[1]]=versionFromResponse(o)}return messageClients({type:"NOTE_CONTENT_CACHED",comprehensive:!0,versionByRemoteUUID:n})})});break;case"REMOVE_CACHED_NOTE_CONTENT":t=caches.open(NOTE_CACHE_NAME).then(function(e){return e["delete"](s.uuid)});break;case"UPDATE_CACHED_NOTE_CONTENT":t=caches.open(NOTE_CACHE_NAME).then(function(e){e.match(s.uuid).then(function(t){if(t){var n=new Blob([s.content],{type:"text/plain"}),a=new Headers(t.headers);a.set("ETag",'"'+s.digest+'"'),a.set("X-Version",s.digest),s.key&&a.set("Encryption-Key",s.key);var c=new Response(n,{status:t.status,statusText:t.statusText,headers:a});return e.put(s.uuid,c)["catch"](function(){return Promise.resolve()})}return Promise.resolve()})})}t&&e.waitUntil&&e.waitUntil(t)}function cacheNoteContent(e,t){const s=versionFromResponse(t);return caches.open(NOTE_CACHE_NAME).then(function(n){return n.put(e,t.clone()).then(function(){return messageClients({type:"NOTE_CONTENT_CACHED",versionByRemoteUUID:{[e]:s}}),t})["catch"](function(){return t})})}function onFetch(e){var t=e.request;if(0===t.url.indexOf("https://api.amplenote.com")||0===t.url.indexOf("https://api.amplenote.com")){const c=t.url.match(/\/notes\/([A-F\d-]+)\/content(?:\?\d+)?$/i);if(!c)return;if("GET"!==t.method)return;var s=c[1],n=fetch(t).then(function(e){return e.ok?cacheNoteContent(s,e):e})["catch"](function(e){return caches.open(NOTE_CACHE_NAME).then(function(t){return t.match(s).then(function(t){return t||Promise.reject(e)})})}),a=new Promise(function(e){setTimeout(e,1e4)}).then(function(){return caches.open(NOTE_CACHE_NAME).then(function(e){return e.match(s).then(function(e){return e||new Promise(function(e){setTimeout(e,1e4)}).then(function(){return Promise.reject("Request timed out")})})})});e.respondWith(Promise.race([n,a]))}else if("GET"===t.method){var c=new URL(t.url);c.origin===location.origin&&("navigate"===t.mode||"GET"===t.method&&t.headers.get("accept").includes("text/html"))&&/^\/pages/.test(c.pathname)?e.respondWith(fetch(t).then(function(e){return e.ok||e.redirected?e:caches.match("/pages/notes.html").then(t=>t||e)})["catch"](function(){return caches.match("/pages/notes.html")})):c.origin===location.origin?e.respondWith(fetch(t)["catch"](function(){return caches.match(t)})):CACHEABLE_ORIGINS.indexOf(c.origin)>-1&&e.respondWith(caches.match(t).then(function(e){return e||fetch(t)}))}}self.addEventListener("activate",onActivate),self.addEventListener("fetch",onFetch),self.addEventListener("install",onInstall),self.addEventListener("message",onMessage)}catch(error){reportError(error)}